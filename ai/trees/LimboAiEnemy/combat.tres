[gd_resource type="BehaviorTree" load_steps=35 format=3 uid="uid://ckn41oejogsuw"]

[ext_resource type="Script" path="res://ai/tasks/LimboAiEnemy/write_node_position_to_blackboard.gd" id="1_2twpc"]
[ext_resource type="Script" path="res://ai/tasks/TestNavEnemy/update_target_is_in_range.gd" id="2_51ny3"]

[sub_resource type="BlackboardPlan" id="BlackboardPlan_bwcuf"]
var/target_position/name = &"target_position"
var/target_position/type = 9
var/target_position/value = Vector3(0, 0, 0)
var/target_position/hint = 0
var/target_position/hint_string = "Holds current target's position"

[sub_resource type="BTComment" id="BTComment_vfg71"]
custom_name = "it may be better to implement them in code directly"

[sub_resource type="BTComment" id="BTComment_ypu1j"]
custom_name = "Some tasks might be bloat"
children = [SubResource("BTComment_vfg71")]

[sub_resource type="BTAction" id="BTAction_4j3he"]
script = ExtResource("1_2twpc")
source_node_var = &"target"
position_var = &"target_position"

[sub_resource type="BTComment" id="BTComment_fkbrq"]
custom_name = "Custom condition : isTargetInRange(range) ?"

[sub_resource type="BTAction" id="BTAction_81esk"]
script = ExtResource("2_51ny3")
target_position_to_check_var = &"target_position"
is_in_range_var = &"target_in_range"
max_distance_to_pass = 3.0

[sub_resource type="BBVariant" id="BBVariant_6kvqs"]
type = 1
saved_value = true
resource_name = "true"

[sub_resource type="BTCheckVar" id="BTCheckVar_eo4fy"]
variable = &"target_in_range"
value = SubResource("BBVariant_6kvqs")

[sub_resource type="BTComment" id="BTComment_5tid1"]
custom_name = "TODO : Look at target before attacking"

[sub_resource type="BBVariant" id="BBVariant_vbgk4"]
type = 3
saved_value = 0.0
resource_name = "0"

[sub_resource type="BTSetAgentProperty" id="BTSetAgentProperty_a80qq"]
property = &"movement_speed_multiplier"
value = SubResource("BBVariant_vbgk4")

[sub_resource type="BBNode" id="BBNode_wn5sm"]
saved_value = NodePath("model/AnimationPlayer")
resource_name = "model/AnimationPlayer"

[sub_resource type="BTPlayAnimation" id="BTPlayAnimation_otdys"]
await_completion = 3.0
animation_player = SubResource("BBNode_wn5sm")
animation_name = &"anim-attack-windup"

[sub_resource type="BBVariant" id="BBVariant_i7l8d"]
type = 1
saved_value = true
resource_name = "true"

[sub_resource type="BBNode" id="BBNode_gbym0"]
saved_value = NodePath("HandPositionAttachment/DamageDealingHandler/DamageDealer")
resource_name = "HandPositionAttachment/DamageDealingHandler/DamageDealer"

[sub_resource type="BTCallMethod" id="BTCallMethod_dg7n2"]
node = SubResource("BBNode_gbym0")
method = &"_set_enabled"
args = Array[BBVariant]([SubResource("BBVariant_i7l8d")])

[sub_resource type="BBNode" id="BBNode_qxfi7"]
saved_value = NodePath("model/AnimationPlayer")
resource_name = "model/AnimationPlayer"

[sub_resource type="BTPlayAnimation" id="BTPlayAnimation_vbsvo"]
await_completion = 3.0
animation_player = SubResource("BBNode_qxfi7")
animation_name = &"anim-attack-swing"

[sub_resource type="BBVariant" id="BBVariant_ixmaq"]
type = 1
saved_value = false
resource_name = "false"

[sub_resource type="BBNode" id="BBNode_5jaur"]
saved_value = NodePath("HandPositionAttachment/DamageDealingHandler/DamageDealer")
resource_name = "HandPositionAttachment/DamageDealingHandler/DamageDealer"

[sub_resource type="BTCallMethod" id="BTCallMethod_ftml0"]
node = SubResource("BBNode_5jaur")
method = &"_set_enabled"
args = Array[BBVariant]([SubResource("BBVariant_ixmaq")])

[sub_resource type="BBNode" id="BBNode_dksss"]
saved_value = NodePath("model/AnimationPlayer")
resource_name = "model/AnimationPlayer"

[sub_resource type="BTPlayAnimation" id="BTPlayAnimation_u170p"]
await_completion = 3.0
animation_player = SubResource("BBNode_dksss")
animation_name = &"anim-attack-recover"

[sub_resource type="BBVariant" id="BBVariant_plkvn"]
type = 3
saved_value = 1.0
resource_name = "1"

[sub_resource type="BTSetAgentProperty" id="BTSetAgentProperty_cfdka"]
property = &"movement_speed_multiplier"
value = SubResource("BBVariant_plkvn")

[sub_resource type="BTSequence" id="BTSequence_7a1uh"]
custom_name = "Attack Target"
children = [SubResource("BTAction_4j3he"), SubResource("BTComment_fkbrq"), SubResource("BTAction_81esk"), SubResource("BTCheckVar_eo4fy"), SubResource("BTComment_5tid1"), SubResource("BTSetAgentProperty_a80qq"), SubResource("BTPlayAnimation_otdys"), SubResource("BTCallMethod_dg7n2"), SubResource("BTPlayAnimation_vbsvo"), SubResource("BTCallMethod_ftml0"), SubResource("BTPlayAnimation_u170p"), SubResource("BTSetAgentProperty_cfdka")]

[sub_resource type="BTAction" id="BTAction_sxpfx"]
script = ExtResource("1_2twpc")
source_node_var = &"target"
position_var = &"target_position"

[sub_resource type="BBVariant" id="BBVariant_ceni3"]
type = 9
value_source = 1
variable = &"target_position"
resource_name = "$target_position"

[sub_resource type="BBNode" id="BBNode_wdeal"]
saved_value = NodePath("StateMachine/AliveState")
resource_name = "StateMachine/AliveState"

[sub_resource type="BTCallMethod" id="BTCallMethod_5q4lt"]
node = SubResource("BBNode_wdeal")
method = &"set_movement_target"
args = Array[BBVariant]([SubResource("BBVariant_ceni3")])

[sub_resource type="BTSequence" id="BTSequence_itepf"]
custom_name = "Move to Target"
children = [SubResource("BTAction_sxpfx"), SubResource("BTCallMethod_5q4lt")]

[sub_resource type="BTSelector" id="BTSelector_r2med"]
children = [SubResource("BTComment_ypu1j"), SubResource("BTSequence_7a1uh"), SubResource("BTSequence_itepf")]

[resource]
blackboard_plan = SubResource("BlackboardPlan_bwcuf")
root_task = SubResource("BTSelector_r2med")
