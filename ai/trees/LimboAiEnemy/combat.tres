[gd_resource type="BehaviorTree" load_steps=32 format=3 uid="uid://ckn41oejogsuw"]

[ext_resource type="Script" path="res://ai/tasks/TestNavEnemy/get_target_position.gd" id="1_7b5t1"]
[ext_resource type="Script" path="res://ai/tasks/TestNavEnemy/update_target_is_in_range.gd" id="2_51ny3"]
[ext_resource type="Script" path="res://ai/tasks/TestNavEnemy/update_tracking_position.gd" id="3_pwfc1"]

[sub_resource type="BlackboardPlan" id="BlackboardPlan_bwcuf"]

[sub_resource type="BTAction" id="BTAction_8xljn"]
script = ExtResource("1_7b5t1")
target_position_var = &"target_position"

[sub_resource type="BTAction" id="BTAction_81esk"]
script = ExtResource("2_51ny3")
target_position_to_check_var = &"target_position"
is_in_range_var = &"target_in_range"
max_distance_to_pass = 3.0

[sub_resource type="BBVariant" id="BBVariant_6kvqs"]
type = 1
saved_value = true
resource_name = "true"

[sub_resource type="BTCheckVar" id="BTCheckVar_eo4fy"]
variable = &"target_in_range"
value = SubResource("BBVariant_6kvqs")

[sub_resource type="BTComment" id="BTComment_5tid1"]
custom_name = "TODO : Look at target before attacking"

[sub_resource type="BTComment" id="BTComment_amgk8"]
custom_name = "TODO : Use the 3D overlay addon to visualize shapes !"

[sub_resource type="BBVariant" id="BBVariant_vbgk4"]
type = 3
saved_value = 0.0

[sub_resource type="BTSetAgentProperty" id="BTSetAgentProperty_a80qq"]
property = &"movement_speed_multiplier"
value = SubResource("BBVariant_vbgk4")

[sub_resource type="BBNode" id="BBNode_wn5sm"]
saved_value = NodePath("model/AnimationPlayer")
resource_name = "model/AnimationPlayer"

[sub_resource type="BTPlayAnimation" id="BTPlayAnimation_otdys"]
await_completion = 3.0
animation_player = SubResource("BBNode_wn5sm")
animation_name = &"anim-attack-windup"

[sub_resource type="BBVariant" id="BBVariant_i7l8d"]
type = 1
saved_value = true
resource_name = "true"

[sub_resource type="BBNode" id="BBNode_gbym0"]
saved_value = NodePath("HandPositionAttachment/DamageDealingHandler/DamageDealer")
resource_name = "HandPositionAttachment/DamageDealingHandler/DamageDealer"

[sub_resource type="BTCallMethod" id="BTCallMethod_dg7n2"]
node = SubResource("BBNode_gbym0")
method = &"_set_enabled"
args = Array[BBVariant]([SubResource("BBVariant_i7l8d")])

[sub_resource type="BBNode" id="BBNode_qxfi7"]
saved_value = NodePath("model/AnimationPlayer")
resource_name = "model/AnimationPlayer"

[sub_resource type="BTPlayAnimation" id="BTPlayAnimation_vbsvo"]
await_completion = 3.0
animation_player = SubResource("BBNode_qxfi7")
animation_name = &"anim-attack-swing"

[sub_resource type="BBVariant" id="BBVariant_ixmaq"]
type = 1
saved_value = false
resource_name = "false"

[sub_resource type="BBNode" id="BBNode_5jaur"]
saved_value = NodePath("HandPositionAttachment/DamageDealingHandler/DamageDealer")
resource_name = "HandPositionAttachment/DamageDealingHandler/DamageDealer"

[sub_resource type="BTCallMethod" id="BTCallMethod_ftml0"]
node = SubResource("BBNode_5jaur")
method = &"_set_enabled"
args = Array[BBVariant]([SubResource("BBVariant_ixmaq")])

[sub_resource type="BBNode" id="BBNode_dksss"]
saved_value = NodePath("model/AnimationPlayer")
resource_name = "model/AnimationPlayer"

[sub_resource type="BTPlayAnimation" id="BTPlayAnimation_u170p"]
await_completion = 3.0
animation_player = SubResource("BBNode_dksss")
animation_name = &"anim-attack-recover"

[sub_resource type="BBVariant" id="BBVariant_plkvn"]
type = 3
saved_value = 1.0
resource_name = "1"

[sub_resource type="BTSetAgentProperty" id="BTSetAgentProperty_cfdka"]
property = &"movement_speed_multiplier"
value = SubResource("BBVariant_plkvn")

[sub_resource type="BTSequence" id="BTSequence_7a1uh"]
custom_name = "Attack Target"
children = [SubResource("BTAction_8xljn"), SubResource("BTAction_81esk"), SubResource("BTCheckVar_eo4fy"), SubResource("BTComment_5tid1"), SubResource("BTComment_amgk8"), SubResource("BTSetAgentProperty_a80qq"), SubResource("BTPlayAnimation_otdys"), SubResource("BTCallMethod_dg7n2"), SubResource("BTPlayAnimation_vbsvo"), SubResource("BTCallMethod_ftml0"), SubResource("BTPlayAnimation_u170p"), SubResource("BTSetAgentProperty_cfdka")]

[sub_resource type="BTAction" id="BTAction_f3m2n"]
script = ExtResource("1_7b5t1")
target_position_var = &"target_position"

[sub_resource type="BTAction" id="BTAction_qbbml"]
script = ExtResource("3_pwfc1")
target_position_var = "target_position"
tolerance = 1.0

[sub_resource type="BTSequence" id="BTSequence_itepf"]
custom_name = "Move to Target"
children = [SubResource("BTAction_f3m2n"), SubResource("BTAction_qbbml")]

[sub_resource type="BTSelector" id="BTSelector_r2med"]
children = [SubResource("BTSequence_7a1uh"), SubResource("BTSequence_itepf")]

[resource]
blackboard_plan = SubResource("BlackboardPlan_bwcuf")
root_task = SubResource("BTSelector_r2med")
