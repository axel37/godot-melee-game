[gd_scene load_steps=42 format=3 uid="uid://bgx45e0mxvfwf"]

[ext_resource type="PackedScene" uid="uid://bwwxp248vlwcm" path="res://Actors/LimboAiEnemy/enemy.glb" id="1_fodfn"]
[ext_resource type="Script" path="res://Actors/LimboAiEnemy/limbo_ai_enemy.gd" id="1_sjejd"]
[ext_resource type="PackedScene" uid="uid://b57sy8bb34nw7" path="res://Actors/LimboAiEnemy/sword.glb" id="2_5glsx"]
[ext_resource type="Script" path="res://Actors/Damage/damage_dealing_handler.gd" id="4_b2qui"]
[ext_resource type="BehaviorTree" uid="uid://cj3dbrwwunx7r" path="res://ai/trees/LimboAiEnemy/idle.tres" id="4_uvef0"]
[ext_resource type="Script" path="res://Actors/Damage/damage_dealer.gd" id="5_in27c"]
[ext_resource type="BehaviorTree" uid="uid://ckn41oejogsuw" path="res://ai/trees/LimboAiEnemy/combat.tres" id="5_xoe8a"]
[ext_resource type="Script" path="res://Actors/Damage/damage_receiving_handler.gd" id="6_6uon2"]
[ext_resource type="Script" path="res://Actors/Damage/damage_receiver.gd" id="7_k88rw"]
[ext_resource type="Script" path="res://Actors/LimboAiEnemy/stagger_state.gd" id="8_5nv8m"]
[ext_resource type="Script" path="res://Actors/LimboAiEnemy/death_state.gd" id="9_xyjtj"]

[sub_resource type="BoxShape3D" id="BoxShape3D_kkf48"]
size = Vector3(0.2, 0.2, 2)

[sub_resource type="CylinderShape3D" id="CylinderShape3D_eb0p3"]
radius = 0.35

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_vkh05"]
animation = &"anim-attack-recover"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_hj8ke"]
animation = &"anim-attack-swing"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_8lyca"]
animation = &"anim-attack-windup"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_knfv8"]
animation = &"anim-death"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_3a7xr"]
animation = &"anim-guard"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_5hu7l"]
animation = &"anim-hurt"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_67mqs"]
animation = &"anim-idle"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_45x41"]
advance_mode = 2

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_ubpik"]

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_uin68"]
switch_mode = 2
advance_mode = 2

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_xthuk"]
switch_mode = 2
advance_mode = 2

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_g5u14"]
switch_mode = 2
advance_mode = 2

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_ayoh0"]
xfade_time = 0.15

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_doc1x"]
xfade_time = 0.3

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_e8ujc"]
xfade_time = 0.1

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_08afh"]
xfade_time = 0.3

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_tnpy6"]
switch_mode = 2
advance_mode = 2

[sub_resource type="AnimationNodeStateMachine" id="AnimationNodeStateMachine_1tapv"]
states/End/position = Vector2(1054, 102)
states/Start/position = Vector2(159, 87)
states/anim-attack-recover/node = SubResource("AnimationNodeAnimation_vkh05")
states/anim-attack-recover/position = Vector2(746, 283)
states/anim-attack-swing/node = SubResource("AnimationNodeAnimation_hj8ke")
states/anim-attack-swing/position = Vector2(338, 288)
states/anim-attack-windup/node = SubResource("AnimationNodeAnimation_8lyca")
states/anim-attack-windup/position = Vector2(338, 193)
states/anim-death/node = SubResource("AnimationNodeAnimation_knfv8")
states/anim-death/position = Vector2(527, -48)
states/anim-guard/node = SubResource("AnimationNodeAnimation_3a7xr")
states/anim-guard/position = Vector2(658, 47)
states/anim-hurt/node = SubResource("AnimationNodeAnimation_5hu7l")
states/anim-hurt/position = Vector2(338, -35)
states/anim-idle/node = SubResource("AnimationNodeAnimation_67mqs")
states/anim-idle/position = Vector2(338, 93)
transitions = ["Start", "anim-idle", SubResource("AnimationNodeStateMachineTransition_45x41"), "anim-idle", "anim-attack-windup", SubResource("AnimationNodeStateMachineTransition_ubpik"), "anim-attack-windup", "anim-attack-swing", SubResource("AnimationNodeStateMachineTransition_uin68"), "anim-attack-swing", "anim-attack-recover", SubResource("AnimationNodeStateMachineTransition_xthuk"), "anim-attack-recover", "anim-idle", SubResource("AnimationNodeStateMachineTransition_g5u14"), "anim-idle", "anim-guard", SubResource("AnimationNodeStateMachineTransition_ayoh0"), "anim-guard", "anim-idle", SubResource("AnimationNodeStateMachineTransition_doc1x"), "anim-attack-windup", "anim-guard", SubResource("AnimationNodeStateMachineTransition_e8ujc"), "anim-attack-recover", "anim-guard", SubResource("AnimationNodeStateMachineTransition_08afh"), "anim-hurt", "anim-idle", SubResource("AnimationNodeStateMachineTransition_tnpy6")]
graph_offset = Vector2(-64, -49)

[sub_resource type="BlackboardPlan" id="BlackboardPlan_k733v"]

[sub_resource type="BlackboardPlan" id="BlackboardPlan_wlei4"]

[sub_resource type="SphereShape3D" id="SphereShape3D_e1p1f"]
radius = 8.0

[sub_resource type="BoxShape3D" id="BoxShape3D_os25c"]
size = Vector3(1.43945, 1.77649, 3.8916)

[sub_resource type="BoxShape3D" id="BoxShape3D_p4ltd"]
size = Vector3(0.65, 2, 0.65)

[sub_resource type="ParticleProcessMaterial" id="ParticleProcessMaterial_xi3h3"]
emission_shape = 2
emission_sphere_radius = 0.3
angle_min = -180.0
angle_max = 180.0
direction = Vector3(0, 1, 0)
initial_velocity_min = 1.0
initial_velocity_max = 2.0

[sub_resource type="Gradient" id="Gradient_ru15v"]
offsets = PackedFloat32Array(0, 0.169611, 0.773852, 1)
colors = PackedColorArray(1, 1, 1, 1, 0.953833, 0.97, 0.485, 0.882353, 0, 0.595, 0.85, 0.294118, 1, 1, 1, 0)

[sub_resource type="GradientTexture2D" id="GradientTexture2D_4if05"]
gradient = SubResource("Gradient_ru15v")
fill = 1
fill_from = Vector2(0.5, 0.5)
fill_to = Vector2(0.5, 0)
metadata/_snap_enabled = true

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_fxh8x"]
transparency = 3
alpha_hash_scale = 1.0
alpha_antialiasing_mode = 0
blend_mode = 1
shading_mode = 0
albedo_texture = SubResource("GradientTexture2D_4if05")
billboard_mode = 3
particles_anim_h_frames = 1
particles_anim_v_frames = 1
particles_anim_loop = false

[sub_resource type="QuadMesh" id="QuadMesh_nvjgq"]
material = SubResource("StandardMaterial3D_fxh8x")
size = Vector2(0.1, 0.1)

[node name="LimboAiEnemy" type="CharacterBody3D"]
collision_layer = 2147483648
collision_mask = 1610612737
script = ExtResource("1_sjejd")

[node name="NavigationAgent3D" type="NavigationAgent3D" parent="."]
unique_name_in_owner = true
debug_enabled = true

[node name="model" parent="." instance=ExtResource("1_fodfn")]
transform = Transform3D(-1, 0, -8.74228e-08, 0, 1, 0, 8.74228e-08, 0, -1, 0, 0, 0)

[node name="Skeleton3D" parent="model/skeleton" index="0"]
bones/0/position = Vector3(0, -0.387421, 0)
bones/0/rotation = Quaternion(0.00119676, 0.553248, -0.0457368, 0.831759)
bones/1/rotation = Quaternion(0.0489209, -0.137456, -0.0682971, 0.986939)
bones/2/rotation = Quaternion(0.0596225, 0.310644, 0.111649, 0.942062)
bones/3/rotation = Quaternion(-0.125364, -0.609261, 0.0645456, 0.780332)
bones/4/rotation = Quaternion(0.0305394, 0.304062, 0.8598, 0.409095)
bones/5/rotation = Quaternion(0.0916903, 0.312542, 0.552526, 0.767219)
bones/6/rotation = Quaternion(0.207871, 0.0755264, 0.124945, 0.967199)
bones/7/rotation = Quaternion(-0.465212, 0.247495, 0.217642, 0.821557)
bones/8/rotation = Quaternion(-0.453862, -0.463279, -0.607489, 0.458627)
bones/9/rotation = Quaternion(-0.126514, 0.220979, -0.646983, 0.718732)
bones/10/rotation = Quaternion(0.15223, -0.153191, -0.0997788, 0.971289)
bones/11/rotation = Quaternion(0.5077, -0.5347, -0.440142, -0.512458)
bones/11/scale = Vector3(1, 1, 1)
bones/12/rotation = Quaternion(-0.394342, 0.560764, -0.110534, 0.719597)
bones/13/rotation = Quaternion(-0.00785933, 0.0265398, -0.563254, 0.82582)
bones/14/rotation = Quaternion(0.0405117, 0.780687, 0.535773, -0.319114)
bones/15/rotation = Quaternion(-0.820784, 0.110852, 0.0412851, 0.558857)
bones/16/rotation = Quaternion(-0.0227034, -0.0113863, 0.398683, 0.916737)

[node name="HandPositionAttachment" type="BoneAttachment3D" parent="."]
transform = Transform3D(0.120077, -0.100299, -0.987685, -0.992749, -0.00697143, -0.119984, 0.00514891, 0.994933, -0.100409, -0.866359, 0.78754, 0.142679)
bone_name = "r-hand"
bone_idx = 7
use_external_skeleton = true
external_skeleton = NodePath("../model/skeleton/Skeleton3D")

[node name="swordmodel" parent="HandPositionAttachment" instance=ExtResource("2_5glsx")]
transform = Transform3D(-1, 8.74228e-08, 0, -8.74228e-08, -1, 0, 0, 0, 1, 0, 0, 0)

[node name="DamageDealingHandler" type="Node3D" parent="HandPositionAttachment"]
script = ExtResource("4_b2qui")

[node name="DamageDealer" type="Area3D" parent="HandPositionAttachment/DamageDealingHandler"]
collision_layer = 2147483648
collision_mask = 1610612736
script = ExtResource("5_in27c")

[node name="CollisionShape3D" type="CollisionShape3D" parent="HandPositionAttachment/DamageDealingHandler/DamageDealer"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, -0.1, 1.195)
shape = SubResource("BoxShape3D_kkf48")

[node name="PhysicsShape" type="CollisionShape3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0)
shape = SubResource("CylinderShape3D_eb0p3")

[node name="BlenderAnimationTree" type="AnimationTree" parent="."]
active = false
root_node = NodePath("../model")
tree_root = SubResource("AnimationNodeStateMachine_1tapv")
anim_player = NodePath("../model/AnimationPlayer")

[node name="LimboHSM" type="LimboHSM" parent="."]
unique_name_in_owner = true

[node name="RoamingState" type="BTState" parent="LimboHSM"]
behavior_tree = ExtResource("4_uvef0")
blackboard_plan = SubResource("BlackboardPlan_k733v")
unique_name_in_owner = true

[node name="CombatState" type="BTState" parent="LimboHSM"]
behavior_tree = ExtResource("5_xoe8a")
blackboard_plan = SubResource("BlackboardPlan_wlei4")
unique_name_in_owner = true

[node name="StaggerState" type="LimboState" parent="LimboHSM" node_paths=PackedStringArray("animation_player")]
unique_name_in_owner = true
script = ExtResource("8_5nv8m")
animation_player = NodePath("../../model/AnimationPlayer")
animation_name = &"anim-hurt"

[node name="DeathState" type="LimboState" parent="LimboHSM" node_paths=PackedStringArray("animation_player")]
unique_name_in_owner = true
script = ExtResource("9_xyjtj")
animation_player = NodePath("../../model/AnimationPlayer")
animation_name = &"anim-death"

[node name="KeepFollowingArea3D" type="Area3D" parent="."]
unique_name_in_owner = true
collision_layer = 0
collision_mask = 536870912

[node name="CollisionShape3D" type="CollisionShape3D" parent="KeepFollowingArea3D"]
shape = SubResource("SphereShape3D_e1p1f")

[node name="TargetDetectorArea3D" type="Area3D" parent="."]
unique_name_in_owner = true
collision_layer = 0
collision_mask = 536870912

[node name="CollisionShape3D" type="CollisionShape3D" parent="TargetDetectorArea3D"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1.01112, -1.95124)
shape = SubResource("BoxShape3D_os25c")

[node name="DamageReceivingHandler" type="Node3D" parent="."]
script = ExtResource("6_6uon2")

[node name="DamageReceiver" type="Area3D" parent="DamageReceivingHandler"]
collision_layer = 0
collision_mask = 1610612736
script = ExtResource("7_k88rw")

[node name="CollisionShape3D" type="CollisionShape3D" parent="DamageReceivingHandler/DamageReceiver"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0)
shape = SubResource("BoxShape3D_p4ltd")

[node name="HurtParticles" type="GPUParticles3D" parent="."]
unique_name_in_owner = true
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1.19033, 0)
emitting = false
one_shot = true
explosiveness = 1.0
process_material = SubResource("ParticleProcessMaterial_xi3h3")
draw_pass_1 = SubResource("QuadMesh_nvjgq")

[connection signal="body_exited" from="KeepFollowingArea3D" to="." method="_on_keep_following_area_3d_body_exited"]
[connection signal="body_entered" from="TargetDetectorArea3D" to="." method="_on_target_detector_area_3d_body_entered"]
[connection signal="received_damage" from="DamageReceivingHandler" to="." method="_on_damage_receiving_handler_received_damage"]

[editable path="model"]
